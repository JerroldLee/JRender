//min.js
!function(gbl){var typeHim=function(dm){if(void 0===dm)return"undefined";if(null===dm)return"null";var tp=typeof dm;return"string"===tp||"number"===tp||"function"===tp?tp:(tp=Object.prototype.toString.call(dm),-1!==tp.indexOf("rray")||-1!==tp.indexOf("rguments")?"array":-1!==tp.indexOf("ragment")?"fragment":-1!==tp.indexOf("odeList")?"nodelist":-1!==tp.indexOf("lement")?"node":-1!==tp.indexOf("egExp")?"regexp":-1!==tp.indexOf("bject")?"object":!1)},miniExtend=function(aob,ob){var i=null;for(i in ob)i in aob||(aob[i]=ob[i]);return aob},getValue=function(name,ob){if(-1!==["number","string"].indexOf(typeof ob))return!1;for(var ar=name.split("."),n=ar.length,temp="",i=0;n>i;i+=1)if(temp=ar[i],ob=ob[temp],void 0===ob)return!1;return ob},getParaName=function(f){var str=f.toString(),s1=str.indexOf("("),s2=str.indexOf(")");return str=str.slice(s1+1,s2),str.split(",")},parseS=function(str){var mat,tp=str.slice(0,str.indexOf(" ")),obs=null,reg=null;return"for"===tp?(reg=/for\s+([\w|\|]+)\s+in\s+([\w|\|\.]+)/,mat=reg.exec(str),obs=[mat[1],mat[2]]):"if"===tp&&(reg=/if\s+([\w|\|\.]+)+\s+([\<\>\=])+\s+([\w|\|\.]+)/,mat=reg.exec(str),obs=[mat[1],mat[2],mat[3]]),obs},compIf=function(vara,expre,varb){switch(expre){case"<":tf=varb>vara;break;case">":tf=vara>varb;break;case"=":tf=vara=varb}return tf},anaTag=function(htm){var reg,regold=/\[\[(\w+)(?=\s)[\w\s\>\<\=\|\.]+\]\]/,mat=null,no=0,lf="",rt="",tp=null,right="",out=[],temp=[];tp=regold.exec(htm);do{if(0===no){if(!tp)return!1;tp=tp[1],reg=new RegExp("\\[\\["+tp+"[\\w\\s\\>\\<\\=\\|\\.]+\\]\\]|(\\[\\[\\/"+tp+"\\]\\])","g"),mat=reg.exec(htm),lf=[mat.index,reg.lastIndex]}else mat=reg.exec(htm);mat[1]?no-=1:no+=1,0===no&&(rt=[mat.index,reg.lastIndex],temp=[{html:htm.slice(0,lf[0])},{html:htm.slice(lf[1],rt[0]),express:htm.slice(lf[0]+2,lf[1]-2)}],htm=right=htm.slice(rt[1]),tp=regold.exec(right),out=out.concat(temp))}while(mat&&tp);return out.push({html:right}),out},filters={upper:function(str){return str.toUpperCase()},lower:function(str){return str.toLowerCase()},length:function(str){return"array"!==typeHim(str)?str:str.length},safe:function(str){return"string"==typeof str?safeHtml(str):void 0}},JRender=function(){this.storeExp={},this.onlyItem=0,this.refOb=[]};JRender.prototype={constructor:JRender,parseS:parseS,compIf:compIf,anaTag:anaTag,filters:filters,setFilter:function(opt){var fil=this.filters;miniExtend(fil,opt)},handVal:function(str,ob,item,blg){var arr=str.split("|"),filter=arr[1],attr=arr[0],iref=null,ref=null,ts=this,storeExp=ts.storeExp,refOb=this.refOb;if("EXPRESS"!==filter){if(-1!==(iref=attr.indexOf("REF")))return ref=attr.slice(iref+3),ref=ref?ref:"OTHER",-1===refOb.indexOf(ref)&&refOb.push(ref),"data-xjref="+ref;var fls=ts.filters,res=getValue(attr,ob);if(filter)if(-1!==filter.indexOf(",")){filter=filter.split(",");for(var fl,j=0,m=filter.length;m>j;j+=1)fl=filter[j],fl in fls&&(res=fls[fl](res,item,blg,ts.store))}else filter in fls&&(res=fls[filter](res,item,blg,ts.store));return res?res:""}var res=storeExp[attr],expob=ts.parseS(res.express);if(2===expob.length){var tmpob=getValue(expob[1],ob);return tmpob===!1?"":{data:tmpob,template:res.html,prefix:expob[0]}}if(3===expob.length){var tmpob=getValue(expob[0],ob);if(tmpob===!1)return"";var tf=ts.compIf(getValue(expob[0],ob),expob[1],expob[2]);return tf?{data:ob,template:res.html}:""}},stringEachArr:function(lf,str,obs,item,blg){var n=str.length,i=0,temp="",inda=0,indb=-1,outstr="",right="",middle="",no=0,first=str.indexOf(lf);if(-1===first)return str;var ts=this;if(-1===first)return!1;for(;n>i;i+=1)temp=str.charAt(i),temp===lf&&(no+=1,no%2!==0?(inda=i,outstr+=str.slice(indb+1,inda)):(indb=i,middle=ts.handVal(str.slice(inda+1,indb),obs,item,blg),outstr+=-1!==["number","string"].indexOf(typeof middle)?middle:ts.render(middle,"middle")));return right=str.slice(indb+1),outstr+right},setEvent:function(opt){this.events=opt},runEvent:function(){for(var m,evts=this.events,refs=this.refOb,i=0,n=refs.length,temp=null,fun=null,dm=null,arg=null,j=1;n>i;i+=1)if(temp=refs[i],dm=$("[data-xjref="+temp+"]"),evts&&temp in evts)if(fun=evts[temp],arg=getParaName(fun),arg.length>1){for(arg[0]=dm,m=arg.length;m>j;j+=1)arg[j]=$("[data-xjref="+arg[j]+"]");fun.apply(null,arg)}else fun(dm)},render:function(opt,mid){void 0===mid&&(this.storeExp={},this.onlyItem=0,this.refOb=[],this.store=opt.data);var oitem,apd=opt.append,ts=this,ob=opt.data,strhtml=opt.template,prefix=opt.prefix,aim=opt.aim,strarr=ts.anaTag(strhtml),tmp="";if("array"===typeHim(strarr))for(var i=0,n=strarr.length,temp=null,otemp=null,exp="";n>i;i+=1)temp=strarr[i],temp.express?(oitem=ts.onlyItem+=1,exp="XJ"+oitem,ts.storeExp[exp]=temp,tmp+="?"+exp+"|EXPRESS?"):tmp+=temp.html;else strarr===!1&&(tmp=strhtml);var tp=typeHim(ob);temp=null;var outstr="";if("array"===tp)for(var i=0,n=ob.length;n>i;i+=1)temp=ob[i],temp.NUMBER=i.toString(),prefix?(otemp={},otemp[prefix]=temp):otemp=temp,outstr+=ts.stringEachArr("?",tmp,otemp,i,n);else outstr=ts.stringEachArr("?",tmp,ob,0,1);if(void 0===mid&&void 0!==aim)if("string"==typeof aim&&(aim=$(aim)),1==apd){var outdom=$(outstr);aim.append(outdom),ts.runEvent(),outdom.removeAttr("data-xjref"),outdom.find("[data-xjref]").removeAttr("data-xjref")}else aim.html("").html(outstr),ts.runEvent(),aim.find("[data-xjref]").removeAttr("data-xjref");return outstr}};var amd="function"==typeof define&&define.amd;amd?define(function(){return JRender}):"object"==typeof module&&module.exports&&(module.exports=JRender),gbl.JRender=JRender}(window);